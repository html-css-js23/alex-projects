<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Flight Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }

        /* Styles for active search tab */
        .search-type-btn.active {
            color: #3b82f6; /* text-blue-500 */
            border-bottom-color: #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <div class="container mx-auto p-4 md:p-8">
        <header class="mb-6 text-center">
            <h1 class="text-4xl font-bold text-white mb-2">Advanced Flight Tracker</h1>
            <p class="text-gray-400">Track flights from an airport or by a specific flight number.</p>
        </header>

        <!-- Search Controls -->
        <div class="max-w-2xl mx-auto mb-8">
            <!-- Search Type Tabs -->
            <div id="search-type-selector" class="flex justify-center mb-4 border-b border-gray-700">
                <button data-type="airport" class="search-type-btn active text-lg font-medium px-6 py-2 border-b-2 transition-colors">By Airport</button>
                <button data-type="flight" class="search-type-btn text-gray-500 hover:text-white text-lg font-medium px-6 py-2 border-b-2 border-transparent transition-colors">By Flight Number</button>
            </div>

            <form id="search-form" class="flex flex-col sm:flex-row gap-4">
                <input 
                    type="text" 
                    id="search-input" 
                    placeholder="Enter Airport Name or Code (e.g., Dubai or OMDB)" 
                    class="flex-grow w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white placeholder-gray-500"
                >
                <button 
                    type="submit" 
                    class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-900"
                >
                    Track
                </button>
            </form>
        </div>

        <!-- Results Section -->
        <main id="results-container" class="max-w-full mx-auto">
            <div id="initial-message" class="text-center text-gray-500 py-16">
                 <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                </svg>
                <p class="mt-4">Select a search type and enter a query to begin.</p>
            </div>
            
            <div id="loading-spinner" class="hidden text-center py-16">
                 <div class="spinner h-12 w-12 border-4 border-blue-500 border-t-transparent rounded-full mx-auto"></div>
                 <p class="mt-4 text-gray-400">Fetching flight data...</p>
            </div>

            <div id="error-message" class="hidden text-center py-16 bg-red-900/20 border border-red-500/30 rounded-lg">
                <p id="error-text" class="text-red-400"></p>
            </div>

            <div id="flight-table-container" class="hidden overflow-x-auto bg-gray-800/50 rounded-lg border border-gray-700">
                <table class="w-full min-w-max text-sm text-left text-gray-300">
                    <thead class="text-xs text-gray-400 uppercase bg-gray-800">
                        <tr>
                            <th scope="col" class="px-5 py-3">Flight</th>
                            <th scope="col" class="px-5 py-3">Airline</th>
                            <th scope="col" class="px-5 py-3">Status</th>
                            <th scope="col" class="px-5 py-3">Origin</th>
                            <th scope="col" class="px-5 py-3">Destination</th>
                            <th scope="col" class="px-5 py-3">Sch. Dep.</th>
                            <th scope="col" class="px-5 py-3">Est. Arr.</th>
                            <th scope="col" class="px-5 py-3">Speed (kts)</th>
                            <th scope="col" class="px-5 py-3">Altitude (ft)</th>
                        </tr>
                    </thead>
                    <tbody id="flight-table-body">
                        <!-- Flight data rows will be inserted here -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <script>
        // --- DATA DATABASES ---
        const AIRPORT_DB = {
            'OMDB': 'Dubai (DXB)', 'KJFK': 'New York (JFK)', 'EGLL': 'London (Heathrow)',
            'RJTT': 'Tokyo (Haneda)', 'LFPG': 'Paris (CDG)', 'YSSY': 'Sydney (SYD)',
            'KLAX': 'Los Angeles (LAX)', 'ZBAA': 'Beijing (PEK)', 'WSSS': 'Singapore (SIN)',
            'EHAM': 'Amsterdam (AMS)', 'CYYZ': 'Toronto (YYZ)', 'KATL': 'Atlanta (ATL)',
            'KORD': 'Chicago (O\'Hare)', 'EDDF': 'Frankfurt (FRA)', 'OMAA': 'Abu Dhabi (AUH)',
        };
        const AIRLINE_DB = {
            'EK': 'Emirates', 'EY': 'Etihad Airways', 'QR': 'Qatar Airways', 'UA': 'United Airlines',
            'DL': 'Delta Air Lines', 'AA': 'American Airlines', 'BA': 'British Airways', 'LH': 'Lufthansa',
            'AF': 'Air France', 'SQ': 'Singapore Airlines', 'QF': 'Qantas', 'JL': 'Japan Airlines',
        };

        // --- DOM Elements ---
        const searchForm = document.getElementById('search-form');
        const searchInput = document.getElementById('search-input');
        const searchTypeSelector = document.getElementById('search-type-selector');
        
        const initialMessage = document.getElementById('initial-message');
        const loadingSpinner = document.getElementById('loading-spinner');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const flightTableContainer = document.getElementById('flight-table-container');
        const flightTableBody = document.getElementById('flight-table-body');
        
        let currentSearchType = 'airport';

        // --- Event Listeners ---
        searchTypeSelector.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON' && e.target.dataset.type) {
                currentSearchType = e.target.dataset.type;
                updateSearchUI();
            }
        });

        searchForm.addEventListener('submit', handleFormSubmit);

        // --- Core Functions ---

        /**
         * Updates the UI when the search type changes.
         */
        function updateSearchUI() {
            document.querySelectorAll('.search-type-btn').forEach(btn => {
                btn.classList.remove('active', 'text-blue-500');
                btn.classList.add('text-gray-500');
            });
            const activeButton = document.querySelector(`.search-type-btn[data-type="${currentSearchType}"]`);
            activeButton.classList.add('active', 'text-blue-500');
            activeButton.classList.remove('text-gray-500');
            
            if (currentSearchType === 'airport') {
                searchInput.placeholder = 'Enter Airport Name or Code (e.g., Dubai or OMDB)';
            } else {
                searchInput.placeholder = 'Enter Flight Number (e.g., EK201)';
            }
            searchInput.value = '';
        }

        /**
         * Main handler for form submission.
         */
        async function handleFormSubmit(e) {
            e.preventDefault();
            const query = searchInput.value.trim();

            if (!query) {
                showError('Please enter a search query.');
                return;
            }

            hideAllSections();
            loadingSpinner.classList.remove('hidden');

            try {
                let flightData;
                if (currentSearchType === 'airport') {
                    const airportCode = findAirportCode(query);
                    if (!airportCode) {
                        throw new Error(`Airport "${query}" not found.`);
                    }
                    flightData = await fetchFakeFlightData(airportCode, 'airport');
                } else {
                    flightData = await fetchFakeFlightData(query.toUpperCase(), 'flight');
                }
                renderFlightData(flightData);
            } catch (error) {
                showError(error.message);
            } finally {
                loadingSpinner.classList.add('hidden');
            }
        }
        
        /**
         * Renders the flight data into the table.
         */
        function renderFlightData(flights) {
            flightTableBody.innerHTML = '';
            if (flights.length === 0) {
                showError('No flights found for your query.');
                return;
            }
            flights.forEach(flight => {
                const row = document.createElement('tr');
                row.className = 'bg-gray-800 border-b border-gray-700 hover:bg-gray-700/50 transition-colors duration-200';
                
                row.innerHTML = `
                    <td class="px-5 py-4 font-medium text-white whitespace-nowrap">
                        <div class="font-bold">${flight.flightNumber}</div>
                        <div class="text-xs text-gray-400 font-mono">${flight.tailNumber}</div>
                    </td>
                    <td class="px-5 py-4">${flight.airline.name}</td>
                    <td class="px-5 py-4">${createStatusBadge(flight.status)}</td>
                    <td class="px-5 py-4">${flight.origin.name}</td>
                    <td class="px-5 py-4">${flight.destination.name}</td>
                    <td class="px-5 py-4 font-mono">${flight.scheduledDeparture}</td>
                    <td class="px-5 py-4 font-mono text-cyan-400">${flight.estimatedArrival}</td>
                    <td class="px-5 py-4 font-mono">${flight.speed}</td>
                    <td class="px-5 py-4 font-mono">${flight.altitude}</td>
                `;
                flightTableBody.appendChild(row);
            });
            flightTableContainer.classList.remove('hidden');
        }

        // --- Helper & UI Functions ---
        const findAirportCode = (query) => {
            const upperQuery = query.toUpperCase();
            if (AIRPORT_DB[upperQuery]) return upperQuery;
            for (const code in AIRPORT_DB) {
                if (AIRPORT_DB[code].toUpperCase().includes(upperQuery)) {
                    return code;
                }
            }
            return null;
        };
        const createStatusBadge = (status) => {
            const colors = {
                'En-Route': 'bg-blue-900 text-blue-300',
                'Landed': 'bg-green-900 text-green-300',
                'Scheduled': 'bg-yellow-900 text-yellow-300',
                'Delayed': 'bg-red-900 text-red-300',
            };
            return `<span class="px-2.5 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${colors[status] || 'bg-gray-700 text-gray-300'}">${status}</span>`;
        };
        const hideAllSections = () => {
            [initialMessage, loadingSpinner, errorMessage, flightTableContainer].forEach(el => el.classList.add('hidden'));
        };
        const showError = (message) => {
            hideAllSections();
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
        };
        const formatTime = (date) => date instanceof Date ? date.toTimeString().slice(0, 5) : '—';
        const getRandomElement = (arr) => arr[Math.floor(Math.random() * arr.length)];
        
        // --- FAKE API SIMULATION ---
        function fetchFakeFlightData(query, type) {
            console.log(`Simulating API call for ${type}: ${query}`);
            return new Promise(resolve => {
                setTimeout(() => {
                    if (type === 'airport') {
                        resolve(generateMockDataByAirport(query));
                    } else {
                        resolve(generateMockDataByFlightNumber(query));
                    }
                }, 1200);
            });
        }
        
        function generateBaseFlight(originCode, destinationCode, depTime) {
            const airlineCode = getRandomElement(Object.keys(AIRLINE_DB));
            const flightDuration = (Math.random() * 8 + 2) * 60 * 60000; // 2-10 hours
            
            return {
                flightNumber: `${airlineCode}${Math.floor(Math.random() * 900) + 100}`,
                airline: { code: airlineCode, name: AIRLINE_DB[airlineCode] },
                origin: { code: originCode, name: AIRPORT_DB[originCode] },
                destination: { code: destinationCode, name: AIRPORT_DB[destinationCode] },
                scheduledDepartureTime: depTime,
                flightDuration: flightDuration,
                speed: '—',
                altitude: '—',
            };
        }

        function generateMockDataByAirport(airportCode) {
            const flights = [];
            const now = new Date();
            const airportCodes = Object.keys(AIRPORT_DB).filter(c => c !== airportCode);

            for (let i = 0; i < 20; i++) {
                const destinationCode = getRandomElement(airportCodes);
                const depTime = new Date(now.getTime() + (i * 15 * 60000) - (4 * 60 * 60000));
                let flight = generateBaseFlight(airportCode, destinationCode, depTime);
                flight.tailNumber = `N${Math.floor(Math.random() * 900) + 100}${String.fromCharCode(65 + Math.floor(Math.random() * 26))}${String.fromCharCode(65 + Math.floor(Math.random() * 26))}`;
                flights.push(finalizeFlightData(flight, now));
            }
            return flights.sort((a,b) => a.scheduledDeparture.localeCompare(b.scheduledDeparture));
        }
        
        function generateMockDataByFlightNumber(flightNumber) {
            const flights = [];
            const now = new Date();
            const airportCodes = Object.keys(AIRPORT_DB);
            const airlineCode = flightNumber.substring(0, 2).toUpperCase();
            const airlineName = AIRLINE_DB[airlineCode];

            if (!airlineName) {
                return []; // Return empty if airline not in DB
            }

            const createTailNumber = () => `N${Math.floor(Math.random() * 900) + 100}${String.fromCharCode(65 + Math.floor(Math.random() * 26))}${String.fromCharCode(65 + Math.floor(Math.random() * 26))}`;

            const createFlightLeg = (originCode, destinationCode, depTime) => {
                const flightDuration = (Math.random() * 8 + 2) * 60 * 60000;
                return {
                    flightNumber: flightNumber,
                    tailNumber: createTailNumber(),
                    airline: { code: airlineCode, name: airlineName },
                    origin: { code: originCode, name: AIRPORT_DB[originCode] },
                    destination: { code: destinationCode, name: AIRPORT_DB[destinationCode] },
                    scheduledDepartureTime: depTime,
                    flightDuration: flightDuration,
                    speed: '—',
                    altitude: '—',
                };
            };

            // Flight 1: Landed
            let origin1 = getRandomElement(airportCodes);
            let destination1 = getRandomElement(airportCodes.filter(c => c !== origin1));
            let depTime1 = new Date(now.getTime() - 20 * 36e5); // Departed 20 hours ago
            flights.push(finalizeFlightData(createFlightLeg(origin1, destination1, depTime1), now, 'Landed'));

            // Flight 2: En-Route
            let origin2 = destination1;
            let destination2 = getRandomElement(airportCodes.filter(c => c !== origin2));
            let depTime2 = new Date(now.getTime() - 2 * 36e5); // Departed 2 hours ago
            flights.push(finalizeFlightData(createFlightLeg(origin2, destination2, depTime2), now, 'En-Route'));

            // Flight 3: Scheduled
            let origin3 = destination2;
            let destination3 = getRandomElement(airportCodes.filter(c => c !== origin3));
            let depTime3 = new Date(now.getTime() + 8 * 36e5); // Departs in 8 hours
            flights.push(finalizeFlightData(createFlightLeg(origin3, destination3, depTime3), now, 'Scheduled'));

            return flights;
        }

        function finalizeFlightData(flight, now, forceStatus = null) {
            const { scheduledDepartureTime, flightDuration } = flight;
            const scheduledArrivalTime = new Date(scheduledDepartureTime.getTime() + flightDuration);
            let estimatedArrivalTime = new Date(scheduledArrivalTime.getTime());
            let status;

            const timeToDeparture = scheduledDepartureTime.getTime() - now.getTime();
            const timeSinceDeparture = now.getTime() - scheduledDepartureTime.getTime();

            if (timeToDeparture > 0) {
                status = 'Scheduled';
            } else {
                status = (timeSinceDeparture > flightDuration) ? 'Landed' : 'En-Route';
            }
            if (forceStatus) status = forceStatus;

            if (status === 'En-Route') {
                estimatedArrivalTime = new Date(scheduledArrivalTime.getTime() + (Math.random() * 20 - 10) * 60000);
                flight.speed = Math.floor(Math.random() * 100 + 450);
                flight.altitude = (Math.floor(Math.random() * 120 + 300) * 100).toLocaleString();
            } else if (status === 'Landed') {
                estimatedArrivalTime = new Date(scheduledArrivalTime.getTime() + (Math.random() * 10 - 5) * 60000);
            }
            
            return {
                ...flight,
                status,
                scheduledDeparture: formatTime(scheduledDepartureTime),
                estimatedArrival: formatTime(estimatedArrivalTime),
            };
        }
    </script>

</body>
</html>
